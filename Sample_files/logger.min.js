define("logger/internal/beat",["lodash","utils","bi"],function(a,b,c){"use strict";function j(c){var d=b.urlUtils.toQueryString(a.omit(c,i));return a.forEach(i,function(a){d+="&"+b.urlUtils.toQueryParam(a,c[a])}),d}function k(b,c,d,e){var g=l(b),h=m(b,d,e);return a.merge({},c,g,h,{et:a.indexOf(f,d)})}function l(a){return{vuuid:n(),vid:a.getSvSession()||"NO_SV",dc:a.serviceTopology.serverName,vsi:d[a.siteId].viewerSessionId,uuid:a.siteHeader.userId,sid:a.siteId,msid:a.getMetaSiteId()}}function m(b,c,d){return{pid:d,pn:o(b,c),st:a.indexOf(e,b.rendererModel.documentType),sr:s(),wr:t(),isjp:"",isp:b.isPremiumUser(),url:q(b.currentUrl.full),ref:document.referrer,ts:p(b,c),c:a.now()}}function n(){var c=b.cookieUtils.getCookie("_wixUIDX")||"";return c=c.slice(a.lastIndexOf(c,"|")+1),c=c.replace(/^(null-user-id|null)$/g,"")}function o(a,b){return"start"===b&&d[a.siteId].pageNumber++,d[a.siteId].pageNumber}function p(b,c){return"start"===c?(d[b.siteId].lastTimeStamp=a.now(),0):a.now()-d[b.siteId].lastTimeStamp}function q(a){return a.replace(/^http(s)?:\/\/(www\.)?/,"")}function r(b){return a.forOwn(b,function(a,c){"boolean"==typeof a&&(b[c]=a?"1":"0")}),b}function s(){var a=window.screen&&window.screen.width||0,b=window.screen&&window.screen.height||0;return a+"x"+b}function t(){var a=0,b=0;return window.innerWidth?(a=window.innerWidth,b=window.innerHeight):window.document&&(document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body&&document.body.clientWidth&&(a=document.body.clientWidth,b=document.body.clientHeight)),a+"x"+b}function u(e,i,l){if("undefined"!=typeof window&&e&&a.contains(f,i)){d[e.siteId]=d[e.siteId]||{pageNumber:1,lastTimeStamp:e.wixBiSession.initialTimestamp||0,viewerSessionId:e.wixBiSession.viewerSessionId||b.guidUtils.getGUID()};var m=k(e,h,i,l);m=r(m);var n=a.merge({queryString:j(m)},{adapter:g.adapter,biUrl:e.getServiceTopologyProperty("biServerUrl")||g.biUrl});c.wixBI.report(e,n)}}var d={},e=["No Site Type","WixSite","UGC","Template"],f=["No Event Type","start","reset","finish"],g={adapter:"bt",biUrl:"http://frog.wix.com/"},h={src:29,evid:3,v:"3.0"},i=["url","ref"];return{reportBeatEvent:u}}),define("logger",["lodash","utils","bi","logger/internal/beat"],function(a,b,c,d){"use strict";function j(b,c){var d={};return a.merge(d,p(b,g)),a.merge(d,o(b,c)),c&&c.description&&(d.desc=JSON.stringify(c.description).slice(0,512)),a.defaults(d,{evid:10}),d}function k(b,c){var d={};return a.merge(d,p(b,h)),a.merge(d,o(b,c)),a.defaults(d,{src:42}),d}function l(b,c,d){var e={};switch(c.reportType){case"error":a.merge(e,j(c,d));break;case"event":a.merge(e,k(c,d))}return a.merge(e,n(b)),e}function m(a,b,c){return{biUrl:a.serviceTopology.biServerUrl,adapter:b.adapter,params:l(a,b,c)}}function n(b){return i[b.siteId]=i[b.siteId]||b.wixBiSession.viewerSessionId||f.getGUID(),{did:b.siteId,msid:b.getMetaSiteId(),uid:b.siteHeader.userId,gsi:e.getCookie("_wix_browser_sess")||f.getGUID(),cid:e.getCookie("_wixCIDX")||"00000000-0000-0000-0000-000000000000",majorVer:3,ver:"",lng:e.getCookie("wixLanguage")||"unknown",server:a.first(b.serviceTopology.serverName.split(".")),viewMode:b.viewMode,vsi:i[b.siteId],tsp:b.publicModel.timeSincePublish||-1}}function o(b,c){var d={},e=b.params;return a.isArray(e)?d=a.pick(c,e):a.isObject(e)&&(d=a.mapValues(e,function(a){return c[a]})),d}function p(b,c){return a.transform(b,function(a,b,d){c[d]&&(a[c[d]]=b)},{})}function q(b){return a.has(b.currentUrl.query,"suppressbi")}function r(a){return a.callCount=a.callCount||0,a.callCount++,a.callLimit&&a.callCount>a.callLimit}function s(a,b){if(b.sampleRatio&&b.sampleRatio>1){var c=a.currentUrl.query.sampleratio;return a.isDebugMode()&&"force"!==c||"none"===c||t(a,b.sampleRatio)}return!0}function t(a,b){var c=a.siteHeader.userId||a.siteId;if(c){var d=c.substr(-4);return parseInt(d,16)%b===0}return 0===Math.floor(Math.random()*b)}function u(a,b){return!q(a)&&!r(b)&&s(a,b)}function v(b,d,e){if(b&&a.isObject(d)&&u(b,d)){var f=m(b,d,e);c.wixBI.report(b,f)}}function w(a){var b=[];return"UGC"!==a.rendererModel.documentType||x(a)||b.push("UA-2117194-61"),a.googleAnalytics&&b.push(a.googleAnalytics),b}function x(b){return a.contains(b.rendererModel.premiumFeatures,"HasDomain")}function y(b,d){b&&a.isString(d)&&(q(b)||c.googleAnalytics.reportPageEvent(d,w(b)))}function A(b,c,d){a.forOwn(d,function(a){a.packageName=b,a.reportType=c}),z[c][b]=d}var e=b.cookieUtils,f=b.guidUtils,g={eventId:"evid",errorCode:"errc",src:"src",category:"cat",issue:"iss",severity:"sev",packageName:"errscp"},h={eventId:"evid",src:"src"},i={},z={event:{},error:{}};return{reportBI:v,reportPageEvent:y,register:A,reportBeatEvent:d.reportBeatEvent}});